<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8" />
        <title>Learn Plover Lessons</title>
        <link href="base.css" rel="stylesheet" type="text/css" />
        <link href="style.less" rel="stylesheet/less" type="text/css" />
        <script src="scripts/type-jig.js"></script>
        <script src="scripts/utils/util.js"></script>
        <script src="scripts/word-drill.js"></script>
        <script src="scripts/utils/steno-display.js"></script>
        <script src="scripts/learn-plover.js"></script>
        <script src="scripts/plover-translations.js"></script>

        <script src="scripts/libs/less.js" ></script>
        <script src="scripts/libs/chart.js"></script>
        <script src="scripts/libs/chartjs-plugin-datalabels.js"></script>
        <link rel="stylesheet" type="text/css" href="font-roboto.css" />
    </head>
    <body>
        <div class="wrapper">
            <div id="form">
                <h1>Learn Plover Exercises</h1>
                <a href="index.html"> 
                    <div class="clickable-form-section center" id="word-drill">
                        <h2>Go back</h2>
                    </div>
                </a>
                <div class="form-section">
                    <form id="selectDrill" action="learn-plover-exercise.html">
                        <ul style="list-style-type: none">
                            <li><select name="drill" multiple></select></li>
                            <li>
                                <label
                                    ><input
                                        name="hints"
                                        type="checkbox"
                                        value="yes"
                                        checked
                                    />
                                    Show hints?</label
                                >
                            </li>
                            <li>
                                <label
                                    ><input
                                        id="randomly"
                                        name="type"
                                        type="radio"
                                        value="randomly"
                                    />
                                    Randomly</label
                                >
                                for
                                <input
                                    name="timeLimit"
                                    type="text"
                                    size="2"
                                    ,
                                    value="10"
                                    onfocus="selectRandomly()"
                                />
                                minutes.
                            </li>
                            <li>
                                <label
                                    ><input
                                        id="ordered"
                                        name="type"
                                        type="radio"
                                        value="once"
                                        checked
                                    />
                                    Once in order.</label
                                >
                            </li>
                            <li>
                                <label
                                    ><input
                                        id="shuffled"
                                        name="type"
                                        type="radio"
                                        value="shuffled"
                                    />
                                    Once in random order.</label
                                >
                            </li>
                            <li>
                                <label
                                    ><input
                                        name="wpm"
                                        type="number"
                                        value=""
                                        step="5"
                                    />
                                    Speed (WPM).</label
                                >
                            </li>
                            <li></li>
                            <button class="form-section__submit-button"></button>
                        </ul>
                    </form>
                </div>
            </div>
        </div>

        <div id="lesson" class="wrapper" style="display: none">
        </div>

        <script>
            window.onload = function () {
                if (document.location.search === "") {
                    var form = document.getElementById("selectDrill");
                    var drill = form.elements.drill;
                    var order = TypeJig.WordSets.LearnPloverOrder;
                    for (var i = 0; i < order.length; ++i) {
                        var option = document.createElement("option");
                        option.appendChild(document.createTextNode(order[i]));
                        drill.appendChild(option);
                    }
                    drill.focus();

                    loadFormState(form);
                    form.addEventListener("submit", function () {
                        saveFormState(form);
                    });
                } else {
                    var fields = parseQueryString(document.location.search);
                    TypeJig.WordSets = TypeJig.WordSets.LearnPlover;
                    var exercise = wordDrill(fields);
                    if (exercise) {
                        if (fields.hints) {
                            var strokes = document.getElementById("strokes");
                            if (fields.floating_hints) {
                                strokes.style.position = "fixed";
                            }
                            var translations =
                                TypeJig.shortestTranslations(
                                    PloverTranslations
                                );
                            var hints = new StenoDisplay(
                                strokes,
                                translations,
                                true
                            );
                        }
                        fields.menu = "learn-plover";

                        displayOnly("lesson");
                        var jig = setExercise(
                            exercise.name,
                            exercise,
                            hints,
                            fields
                        );
                    }
                }
            };

            function selectRandomly() {
                var form = document.getElementById("selectDrill");
                form.elements.type[0].checked = true;
            }

            function saveFormState(form) {
                let radioButtons =
                    document.getElementById("selectDrill").elements["type"];
                let drillType;
                for (let i = 0; i < radioButtons.length; ++i) {
                    if (radioButtons[i].checked) {
                        drillType = radioButtons[i].value;
                        break;
                    }
                }
                save({
                    drill: form.drill.value,
                    hints: form.hints.checked,
                    type: drillType,
                    timeLimit: form.timeLimit.value,
                });
            }

            function loadFormState(form) {
                var loaded = load();
                if (loaded.drill != null) {
                    form.drill.value = loaded.drill;
                }
                if (loaded.hints != null) form.hints.checked = !!loaded.hints;
                if (loaded.type != null) {
                    let radioButtons =
                        document.getElementById("selectDrill").elements["type"];
                    for (let i = 0; i < radioButtons.length; ++i) {
                        let b = radioButtons[i];
                        b.checked = b.value === loaded.type;
                    }
                }
                form.type.value = loaded.type;
                if (loaded.timeLimit) {
                    form.timeLimit.value = loaded.timeLimit;
                }
            }

            var LOCAL_STORAGE_KEY = "learn-plover-form";

            function save(obj) {
                try {
                    localStorage.setItem(
                        LOCAL_STORAGE_KEY,
                        JSON.stringify(obj)
                    );
                } catch (e) {
                    console.error(e);
                }
            }

            function load() {
                try {
                    return (
                        JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) ||
                        {}
                    );
                } catch (e) {
                    console.error(e);
                    return {};
                }
            }

            setTheme();
        </script>
    </body>
</html>
