<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8" />
        <title>Steno Grade</title>
        <link href="style.less" rel="stylesheet/less" type="text/css" />
        <script src="scripts/type-jig.js"></script>
        <script src="scripts/utils/util.js"></script>
        <script src="scripts/word-drill.js"></script>
        <script src="scripts/number-sentences.js"></script>
        <script src="scripts/utils/steno-display.js"></script>
        <script src="scripts/word-sets.js"></script>
        <script src="scripts/plover-translations.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <script src="scripts/libs/less.js" ></script>
        <script src="scripts/libs/chart.js"></script>
        <script src="scripts/libs/chartjs-plugin-datalabels.js"></script>
        <script src="scripts/spectra/spectra.js"></script>
        <script src="scripts/spectra/rules.js"></script>
        <link rel="stylesheet" type="text/css" href="font-roboto.css" />
    </head>
    <body>
        <div id="form" class="wrapper">
            <h1>Choose a drill...</h1>

            <a href="index.html"> 
                <div class="clickable-form-section center" id="word-drill">
                    <h2>Go back</h2>
                </div>
            </a>


            <div class="form-section">
                <div class="caption">
                    <strong>Settings</strong> that apply to all drills
                </div>
                <br />

                <div name="hints" class="radio-buttons--row">
                    <label>
                        <input
                            id="hints"
                            type="radio"
                            name="hints"
                            value="true"
                            checked
                        />
                        Show hints
                    </label>
                    <label>
                        <input
                            id="hints"
                            type="radio"
                            name="hints"
                            value="fail-1"
                            checked
                        />Hint on fail</label
                    >
                    <label
                        ><input
                            id="hints"
                            type="radio"
                            name="hints"
                            value="fail-2"
                            checked
                        />Hint on failed twice</label
                    >
                    <label
                        ><input
                            id="hints"
                            type="radio"
                            name="hints"
                            value="fail-3"
                            checked
                        />Hint on failed three times</label
                    >
                    <label
                        ><input
                            id="hints"
                            type="radio"
                            name="hints"
                            value="false"
                            checked
                        />No hints</label
                    >
                </div>
                <br />

                <div class="checkbox">
                    <label class="checkbox-label" for="multi_word_hints">
                        <input
                            id="multi_word_hints"
                            type="checkbox"
                            name="multi_word_hints"
                            value="true"
                            checked
                        />
                        Show multi-word briefs <small>(These are strokes that don't follow traditional steno rules. So they may be confusing to a beginner. And the hint system may not be 100% accurate)</small> 
                    </label>
                </div>
                <br />
                <div name="live_wpm" class="checkbox">
                    <label
                        ><input
                            id="live_wpm"
                            type="checkbox"
                            name="live_wpm"
                            value="1"
                            checked
                        />Show Live WPM</label
                    >
                </div>
                <br />

                <div name="show_timer" class="checkbox">
                    <label
                        ><input
                            id="show_timer"
                            type="checkbox"
                            name="show_timer"
                            value="1"
                            checked
                        />Show Timer</label
                    >
                </div>
                <br />

                <div name="speed">
                    <label
                        ><input
                            id="wpm"
                            type="number"
                            name="wpm"
                            value=""
                            step="5"
                        />
                        Speed (words per minute) (or
                        <div class="checkbox" style="display:inline-block">
                            <label class="checkbox-label" for="cpm">
                                <input
                                    id="cpm"
                                    type="checkbox"
                                    name="cpm"
                                    value="1"
                                />
                                x5 chars per minute
                            </label>
                        </div>
                        )
                    </label>
                </div>
                <br />
                <div name="alt">
                    <label
                        >Alternate with:
                        <input id="alternate" type="text" name="alternate"
                    /></label>
                </div>
                <br />

                <div class="caption">
                    <strong>Grading rules:</strong>
                </div>
                <br />

                <div name="grading_options" class="row--gap">
                    <label class="checkbox-label">
                        <input
                            id="show_corrections"
                            type="checkbox"
                            name="show_corrections"
                            value="1"
                            checked
                        />
                        Show Correction marks
                    </label>
                    <label class="checkbox-label">
                        <input
                            id="show_live_grading"
                            type="checkbox"
                            name="show_live_grading"
                            value="1"
                            checked
                        />Show Live Grading Results</label
                    >
                </div>
                <br />
                <button
                    onClick="document.getElementById('advanced_grading_rules').scrollIntoView();"
                >
                    Go to advanced rules
                </button>
                <br />
            </div>

            <div class="form-section">
                <div class="caption">Custom <strong>text</strong></div>

                <form class="drill-options" id="custom" action="form.html">
                    <textarea name="drill"></textarea><br />
                    <input type="checkbox" name="type" value="shuffled" />
                    Shuffle lines.<br />
                    Repeat
                    <input
                        type="number"
                        name="repeat"
                        min="1"
                        max="100"
                        step="1"
                        value="1"
                    />
                    times.<br />
                    <button class="form-section__submit-button"></button>
                </form>

            </div>

            <div class="form-section">
                <div class="caption">Custom <strong>Finger Drills</strong></div>

                <form class="drill-options" action="finger-drills.html">
                    Repeat strokes
                    <input type="text" name="strokes" size="18" />
                    <input
                        type="number"
                        name="iterations"
                        value="20"
                        step="5"
                    />
                    times.<br />
                    (e.g. "EFPLT/EFPLS/EFPLTS EBGD/EBGZ/EBGDZ": strokes
                    separated by slashes, sets separated by spaces)<br />
                    <button class="form-section__submit-button" ></button>
                </form>
            </div>

            <div class="form-section">
                <div class="caption">
                    Most used <strong>words</strong> (once, in random order)
                </div>

                <form class="drill-options" action="form.html">
                    <input type="hidden" name="drill" value="NGSL_all_forms" />
                    <input type="hidden" name="type" value="shuffled" />

                    Drill
                    <input
                        type="number"
                        name="count"
                        value="100"
                        min="25"
                        max="1000"
                        step="25"
                    />
                    words starting at rank
                    <input
                        type="number"
                        name="first"
                        value="0"
                        min="0"
                        max="8400"
                        step="25"
                    />
                    (randomly choosing
                    <input
                        type="number"
                        name="choose"
                        value="1000"
                        min="25"
                        max="1000"
                        step="25"
                        style=" width: 4em;"
                    />
                    each time)
                    <br />
                    <button class="form-section__submit-button"></button>
                </form>
            </div>

            <div class="form-section">
                <!-- <b class="red">Under repair</b> -->
                <div class="caption">
                    Randomly <strong>Chosen</strong> Sentences
                </div>

                <form class="drill-options" action="short-sentences.html">
                    <p>
                        <b class="red">NEW</b>: top "0" words gives a set of
                        nearly 200k sentences with unrestricted vocabulary.
                    </p>
                    Drill sentences containing only the top
                    <input
                        id="gutnum"
                        type="number"
                        name="top"
                        value="0"
                        min="0"
                        max="8000"
                        step="100"
                    />
                    most used words<br />

                    Drill Length:
                    <input
                        type="number"
                        name="word_count"
                        value="100"
                        min="50"
                        max="1000"
                        step="50"
                    />
                    words <small>(plus the rest of the last sentence.)</small>
                    <br />

                    <script>
                        document.write(
                            '<input type="hidden" name="seed" value="' +
                                Math.random().toString() +
                                '">'
                        );
                        document
                            .getElementById("gutnum")
                            .addEventListener("input", function (evt) {
                                const num = evt.target,
                                    form = num.form;
                                form.action =
                                    num.value === "0"
                                        ? "short-sentences.html"
                                        : "gutenberg.html";
                            });
                    </script>
                <button class="form-section__submit-button"></button>
                </form>
                <footer>
                    extracted from
                    <a href="https://www.gutenberg.org/">Project Gutenberg</a>
                </footer>
                <!-- <b class="red">Under repair</b> -->

            </div>

            <div class="form-section">
                <div class="caption">
                    Randomly <strong>Generated</strong> Sentences
                </div>

                <form class="drill-options" action="markov.html">
                    Drill Length:
                    <input
                        type="number"
                        name="word_count"
                        value="100"
                        min="50"
                        max="1000"
                        step="50"
                    />
                    words <small>(plus the rest of the last sentence.)</small>
                    <br />

                    <script>
                        document.write(
                            '<input type="hidden" name="seed" value="' +
                                Math.random().toString() +
                                '">'
                        );
                    </script>

                    <button class="form-section__submit-button"></button>
                </form>
            </div>

            <div class="form-section">
                <div class="caption">
                    <b class="red">NEW</b> AI Generated Challenging Sentences
                </div>

                <form class="drill-options" action="markov-durations.html">
                    <p>
                        Using tracked word durations a built in AI generates
                        sentences that will challenge you. Giving you words that
                        you struggle with
                    </p>

                    Drill Length:
                    <input
                        type="number"
                        name="word_count"
                        value="100"
                        min="50"
                        max="1000"
                        step="50"
                    />
                    words <small>(plus the rest of the last sentence.)</small>
                    <br />

                    Difficulty:
                    <input
                        type="number"
                        name="duration_bias"
                        value="40"
                        min="0"
                        max="100"
                        step="10"
                    />
                    %
                    <small
                        >(how likely it will give you words you struggle
                        with)</small
                    >
                    <br />

                    <script>
                        document.write(
                            '<input type="hidden" name="seed" value="' +
                                Math.random().toString() +
                                '">'
                        );
                    </script>
                    <button class="form-section__submit-button"></button>
                </form>
            </div>
            <div class="form-section">
                <div class="caption">
                    <strong>Quotes</strong> from
                    <a
                        href="https://github.com/Miodec/monkeytype/blob/master/static/quotes/english.json"
                        >Monkeytype</a
                    >.
                </div>

                <form class="drill-options center" action="monkeytype-quote.html">
                    Drill length:
                    <!-- <ul> -->
                        <div>

                            <div name="length" class="radio-buttons--column">
                                <label>
                                    <input
                                        id="monkeytype-quote-length"
                                        type="radio"
                                        name="monkeytype-quote-length"
                                        value="all"
                                        checked
                                    />
                                    All
                                </label>
                                <label>
                                    <input
                                        id="monkeytype-quote-length"
                                        type="radio"
                                        name="monkeytype-quote-length"
                                        value="short"
                                    />
                                    Short (&lt;100 characters)
                                </label>

                                <label>
                                    <input
                                        id="monkeytype-quote-length"
                                        type="radio"
                                        name="monkeytype-quote-length"
                                        value="medium"
                                    />
                                    Medium (101-300 characters)
                                </label>

                                <label>
                                    <input
                                        id="monkeytype-quote-length"
                                        type="radio"
                                        name="monkeytype-quote-length"
                                        value="long"
                                    />
                                    Long (301-600 characters)
                                </label>

                                <label>
                                    <input
                                        id="monkeytype-quote-length"
                                        type="radio"
                                        name="monkeytype-quote-length"
                                        value="thicc"
                                    />
                                    Thicc (&gt;600 characters)
                                </label>
                            </div>
                        </div>


                        <!-- <li style="list-style: none">
                            <input
                                type="radio"
                                name="length"
                                value="all"
                                checked
                            /><label for="length">All</label>
                        </li>
                        <li style="list-style: none">
                            <input
                                type="radio"
                                name="length"
                                value="short"
                            /><label for="length"
                                >Short (&lt;100 characters)</label
                            >
                        </li>
                        <li style="list-style: none">
                            <input
                                type="radio"
                                name="length"
                                value="medium"
                            /><label for="length"
                                >Medium (101-300 characters)</label
                            >
                        </li>
                        <li style="list-style: none">
                            <input
                                type="radio"
                                name="length"
                                value="long"
                            /><label for="length"
                                >Long (301-600 characters)</label
                            >
                        </li>
                        <li style="list-style: none">
                            <input
                                type="radio"
                                name="length"
                                value="thicc"
                            /><label for="length"
                                >Thicc (&gt;600 characters)</label
                            >
                        </li> -->
                    <!-- </ul> -->
                    <button class="form-section__submit-button"></button>
                </form>
            </div>

            <div class="form-section">
                <div class="caption">
                    Phonetic <strong>words</strong> that use exactly one
                    starting <strong>consonant</strong> key, exactly one
                    <strong>vowel</strong> key and exactly one ending
                    <strong>consonant</strong>.
                </div>

                <form class="drill-options" action="form.html">
                    <input type="hidden" name="drill" value="singleStrokeCVC" />
                    <input type="hidden" name="type" value="randomly" />

                    Drill Time:
                    <input
                        type="number"
                        name="timeLimit"
                        value="3"
                        min="1"
                        max="60"
                        size="3"
                    />
                    minutes.
                    <br />

                    <button class="form-section__submit-button"></button>
                </form>
            </div>

            <div class="form-section">
                <div class="caption">
                    <strong>Numbers</strong> 1-99 in simple sentences
                </div>

                <form class="drill-options" action="form.html">
                    <input type="hidden" name="drill" value="NumberSentences" />
                    <input type="hidden" name="type" value="randomly" />

                    Drill Time:
                    <input
                        type="number"
                        name="timeLimit"
                        value="3"
                        min="1"
                        max="60"
                    />
                    minutes.
                    <br />

                    <button class="form-section__submit-button"></button>
                </form>

            </div>

            <div class="form-section">
                <b class="red">Under Repair</b>
                <div class="caption">
                    Da Dreaded Dueling Digit Duo <strong>Finger Drills</strong>
                </div>

                <form class="drill-options" action="finger-drills.html">
                    Section
                    <input
                        type="number"
                        name="section"
                        value="1"
                        min="1"
                        max="27"
                    /><br />

                    Alternate
                    <input
                        type="number"
                        name="iterations"
                        value="20"
                        step="5"
                    />
                    times.<br />
                    <button class="form-section__submit-button"></button>
                </form>
                <b class="red">Under Repair</b>

            </div>

            <div class="form-section">
                <div class="caption">Other drills.</div>
                <ul>
                    <li>
                        <a href="two-key.html"
                            >Sentences which (mostly) only use two keys at
                            once</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=shortAndLongA&type=shuffled&select=shuffled&hints=true"
                            >Short and Long A words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=ST%20words&drill=SH%20words&drill=CH%20words&type=shuffled&hints=true"
                            >"st-", "sh-", and "ch-" words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=-LD%20words&drill=-LT%20words&drill=-RT%20words&type=shuffled&hints=true"
                            >Simple "-ld", "-lt", and "-rt" words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=%2bLD%20words&drill=%2bLT%20words&drill=%2bRT%20words&type=shuffled&hints=true"
                            >Extended "-ld", "-lt", and "-rt" words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=-LD%20words&drill=-LT%20words&drill=-RT%20words&drill=%2bLD%20words&drill=%2bLT%20words&drill=%2bRT%20words&type=shuffled&hints=true"
                            >All "-ld", "-lt", and "-rt" words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=d-/b-&type=randomly&timeLimit=3"
                            >D- and B- words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=ite/ight&type=randomly&timeLimit=3"
                            >-ite/-ight words</a
                        >
                    </li>
                    <li>
                        <a href="form.html?drill=nch&type=randomly&timeLimit=3"
                            >"nch" words</a
                        >
                    </li>
                    <li>
                        <a
                            href="form.html?drill=-ld/-lt&drill=-nj&type=randomly&timeLimit=5"
                            >"-nj" words mixed with "-ld/"/"-lt" ones.</a
                        >
                    </li>
                </ul>

                <p>
                    <strong>Note</strong> on Finger Drills. Delete (plover v3)
                    or disable (plover v4) all dictionaries but
                    <code>commands.json</code> (in plover v3, delete all
                    dictionaries and save to get the default config back). In
                    plover v4, check out the plover-dict-control plugin which
                    allows you to define strokes to switch dictionaries.
                </p>
            </div>
            <div class="form-section" id="advanced_grading_rules">
                <div class="caption">
                    <strong>Advanced Grading Rules</strong> that apply to all
                    drills
                </div>

                <br />

                <label
                    ><input
                        id="grade_rules_droppedWordMaxJump"
                        type="number"
                        name="wpm"
                        value="5"
                        step="1"
                    />
                    Allowed Number of Dropped Words
                </label>
                <br />
                <br />

                <label
                    ><input
                        id="grade_rules_addedWordMaxJump"
                        type="number"
                        name="wpm"
                        value="5"
                        step="1"
                    />
                    Allowed Number of Incorrectly Added Words
                </label>
            </div>
        </div>

        <div id="lesson" class="wrapper" style="display: none"></div>
    </body>
    <script>
        prepareInput("monkeytype-quote-length");
        setTheme()
        function runExercise(fields) {
            if (fields.drill === "NumberSentences")
                exercise = numberSentences(fields);
            else exercise = wordDrill(fields);
            console.log("Setting Exersize" + exercise);
            if (exercise) {
                if (fields.hints) {
                    var strokes = document.getElementsByClassName("strokes")[0];
                    if (fields.floating_hints) {
                        strokes.style.position = "fixed";
                    }
                    var translations =
                        TypeJig.shortestTranslations(PloverTranslations);
                    var hints = new StenoDisplay(strokes, translations, true);
                }
                var options = fields;

                // options.hints = 1;
                displayOnly("lesson");
                return setExercise(exercise.name, exercise, hints, options);
            }
        }

        function runCustom(evt) {
            evt.preventDefault();
            var fields = getFormFields(this);
            if (storageAvailable("localStorage")) {
                localStorage.custom = fields.drill;
            }
            if (fields.shuffleLines) {
                // Don't shuffle words.
                delete fields.type;
                // Pre-shuffle lines.
                fields.drill = shuffle(fields.drill.trim().split(/\n+/m)).join(
                    " "
                );
            }
            let drill = fields.drill.trim().split(/\s+/m);
            let n = +fields.repeat || 1;
            TypeJig.WordSets.custom = [];
            for (let i = 0; i < n; ++i) TypeJig.WordSets.custom.push(...drill);
            fields.drill = "custom";
            var jig = runExercise(fields);
            initializeButtons(jig);
        }

        loadSettings();
        if (storageAvailable("localStorage") && localStorage.custom != null) {
            let custom = document.getElementById("custom");
            custom.elements.drill.value = localStorage.custom;
        }

        $(document).ready(function () {
            populatePage();

            if (document.location.search !== "") {
                var jig = runExercise(
                    parseQueryString(document.location.search)
                );
                initializeButtons(jig);
            } else {
                // Add event listeners to get settings before submitting.
                // var forms = document.querySelectorAll("form");
                for (const form of $("form")) {
                    if (form.id === "custom") {
                        form.addEventListener("submit", runCustom);
                    }
                }
            }
            var another = $("#new");
            another.click(function () {
                let exercise = wordDrill(
                    parseQueryString(document.location.search)
                );
                jig.exercise = exercise;
                jig.reset();
                // initializeButtons(jig);
            });

            // Get keyboard input from entire page
            $("body").keydown(function (e) {
                // console.log(e);
                //prevent deafault
                //If key is down find the div with the class "form-section--selected". If there is no div with the class "form-section--selected" then select the first div.
                //Then set the div below it to be the div with the class "form-section--selected".
                var keyString = e.key;
                switch (keyString) {
                    case "Enter":
                        // Enter key
                        var selected = $(".form-section--selected");
                        //Find the button inside of the selected div and click it. recurse
                        console.log(selected);
                        selected.find("button").click();
                        break;
                    case " ":
                        // Space
                        $("#show-hint").click();
                        break;
                    case "ArrowLeft":
                        // Left arrow
                        $("#back").click();
                        break;
                    case "ArrowRight":
                        // Right arrow
                        $("#again").click();
                        break;
                   case "ArrowDown":
                        e.preventDefault();

                        // Down arrow
                        var selectedDiv = $(".form-section--selected");
                        var targetDiv = selectedDiv.length == 0
                            ? $(".form-section").first()
                            : selectedDiv.next();
                        if (targetDiv.length > 0) {
                            selectedDiv.removeClass("form-section--selected");
                            targetDiv.addClass("form-section--selected");
                            targetDiv[0].scrollIntoView({ block: "center" });
                        }
                        break;
                    case "ArrowUp":
                        e.preventDefault();
                        // Up arrow
                        var selectedDiv = $(".form-section--selected");
                        var targetDiv = selectedDiv.length == 0
                            ? $(".form-section").first()
                            : selectedDiv.prev();
                        if (targetDiv.length > 0) {
                            selectedDiv.removeClass("form-section--selected");
                            targetDiv.addClass("form-section--selected");
                            targetDiv[0].scrollIntoView({ block: "center" });
                        }
                        break;
                    default:
                        break;
                }
            });
        });
    </script>
</html>
